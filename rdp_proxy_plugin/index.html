<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–≥–∏–Ω –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º RDP</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #28a745;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .permissions-section {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
        }

        .permission-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .permission-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .permission-text {
            flex: 1;
        }

        .permission-text h3 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .permission-text p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }

        .permission-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-granted {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-denied {
            background: #f8d7da;
            color: #721c24;
        }

        .monitoring-section {
            background: #f3e5f5;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #9c27b0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #9c27b0;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .alert-section {
            background: #ffebee;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #f44336;
        }

        .alert-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .alert-time {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .alert-message {
            font-weight: bold;
            color: #d32f2f;
        }

        .controls {
            text-align: center;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç –ü–ª–∞–≥–∏–Ω –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞</h1>
            <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (RDP) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="content">
            <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ -->
            <div class="status-panel">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <h2>–°—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
                </div>
                <p>–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è RDP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="monitoringProgress"></div>
                </div>
            </div>

            <!-- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è -->
            <div class="permissions-section">
                <h2>üìπ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞</h2>
                <div class="permission-item">
                    <div class="permission-icon">üì∑</div>
                    <div class="permission-text">
                        <h3>–í–µ–±-–∫–∞–º–µ—Ä–∞</h3>
                        <p>–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å–∂–∞—Ç–∏—è RDP</p>
                    </div>
                    <div class="permission-status status-pending" id="cameraStatus">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                </div>
                <div class="permission-item">
                    <div class="permission-icon">üé§</div>
                    <div class="permission-text">
                        <h3>–ú–∏–∫—Ä–æ—Ñ–æ–Ω</h3>
                        <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞—É–¥–∏–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–≤—É–∫–æ–≤ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                    </div>
                    <div class="permission-status status-pending" id="microphoneStatus">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                </div>
            </div>

            <!-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
            <div class="monitoring-section">
                <h2>üìä –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="mouseMovements">0</div>
                        <div class="metric-label">–î–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="keystrokes">0</div>
                        <div class="metric-label">–ù–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="suspiciousActivities">0</div>
                        <div class="metric-label">–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="confidenceLevel">0%</div>
                        <div class="metric-label">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏</div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è -->
            <div class="alert-section">
                <h2>‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
                <div id="alertsContainer">
                    <p style="color: #666; font-style: italic;">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</p>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="controls">
                <button class="btn btn-success" onclick="startMonitoring()">
                    <span id="startText">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</span>
                    <span class="loading hidden" id="startLoading"></span>
                </button>
                <button class="btn btn-danger" onclick="stopMonitoring()">üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
                <button class="btn" onclick="generateReport()">üìã –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</button>
            </div>
        </div>

        <div class="footer">
            <p>¬© 2024 –ü–ª–∞–≥–∏–Ω –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p><small>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</small></p>
        </div>
    </div>

    <script src="web_rdp_detector.js"></script>
    <script>
        let detector = null;
        let isMonitoring = false;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        function updatePermissionStatus() {
            navigator.permissions.query({name: 'camera'}).then(result => {
                const cameraStatus = document.getElementById('cameraStatus');
                cameraStatus.textContent = result.state === 'granted' ? '–†–∞–∑—Ä–µ—à–µ–Ω–æ' : '–û—Ç–∫–∞–∑–∞–Ω–æ';
                cameraStatus.className = `permission-status ${result.state === 'granted' ? 'status-granted' : 'status-denied'}`;
            });

            navigator.permissions.query({name: 'microphone'}).then(result => {
                const micStatus = document.getElementById('microphoneStatus');
                micStatus.textContent = result.state === 'granted' ? '–†–∞–∑—Ä–µ—à–µ–Ω–æ' : '–û—Ç–∫–∞–∑–∞–Ω–æ';
                micStatus.className = `permission-status ${result.state === 'granted' ? 'status-granted' : 'status-denied'}`;
            });
        }

        // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        async function startMonitoring() {
            if (isMonitoring) return;

            const startBtn = document.getElementById('startText');
            const loading = document.getElementById('startLoading');
            
            startBtn.classList.add('hidden');
            loading.classList.remove('hidden');

            try {
                detector = new RDPDetector();
                await detector.initialize();
                
                isMonitoring = true;
                updatePermissionStatus();
                startMetricsUpdate();
                
                startBtn.textContent = '‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω';
                startBtn.classList.remove('hidden');
                loading.classList.add('hidden');
                
                showNotification('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', error);
                startBtn.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞';
                startBtn.classList.remove('hidden');
                loading.classList.add('hidden');
                
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: ' + error.message, 'error');
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function stopMonitoring() {
            if (!isMonitoring || !detector) return;

            detector.stop();
            isMonitoring = false;
            
            document.getElementById('startText').textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
            showNotification('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'info');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
        function startMetricsUpdate() {
            setInterval(() => {
                if (!detector || !isMonitoring) return;

                const report = detector.getReport();
                
                document.getElementById('mouseMovements').textContent = 
                    detector.behaviorMetrics.mouseMovements.length;
                document.getElementById('keystrokes').textContent = 
                    detector.behaviorMetrics.keystrokes.length;
                document.getElementById('suspiciousActivities').textContent = 
                    report.totalActivities;
                document.getElementById('confidenceLevel').textContent = 
                    Math.round(report.overallSuspicion * 100) + '%';

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                const progress = Math.min(report.overallSuspicion * 100, 100);
                document.getElementById('monitoringProgress').style.width = progress + '%';
            }, 1000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        function generateReport() {
            if (!detector) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', 'warning');
                return;
            }

            const report = detector.getReport();
            const reportData = {
                timestamp: new Date().toLocaleString('ru-RU'),
                totalActivities: report.totalActivities,
                overallSuspicion: Math.round(report.overallSuspicion * 100) + '%',
                recentActivities: report.recentActivities,
                metrics: {
                    mouseMovements: detector.behaviorMetrics.mouseMovements.length,
                    keystrokes: detector.behaviorMetrics.keystrokes.length
                }
            };

            // –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
            const blob = new Blob([JSON.stringify(reportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rdp-detection-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ —Å–∫–∞—á–∞–Ω', 'success');
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;

            const colors = {
                success: '#4caf50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196f3'
            };

            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CSS –∞–Ω–∏–º–∞—Ü–∏–π
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
        if (window.RDPDetector) {
            const originalNotify = RDPDetector.prototype.notifyUser;
            RDPDetector.prototype.notifyUser = function(alert) {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                const alertsContainer = document.getElementById('alertsContainer');
                if (alertsContainer.children.length === 1 && alertsContainer.children[0].style.fontStyle === 'italic') {
                    alertsContainer.innerHTML = '';
                }

                const alertElement = document.createElement('div');
                alertElement.className = 'alert-item';
                alertElement.innerHTML = `
                    <div class="alert-time">${new Date(alert.timestamp).toLocaleString('ru-RU')}</div>
                    <div class="alert-message">${alert.message}</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${Math.round(alert.confidence * 100)}%
                    </div>
                `;

                alertsContainer.insertBefore(alertElement, alertsContainer.firstChild);

                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                while (alertsContainer.children.length > 10) {
                    alertsContainer.removeChild(alertsContainer.lastChild);
                }

                // –í—ã–∑–æ–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
                originalNotify.call(this, alert);
            };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            updatePermissionStatus();
            showNotification('–ü–ª–∞–≥–∏–Ω –ø—Ä–æ–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'info');
        });
    </script>
</body>
</html>

